CC = clang
OBJDIRREL = bin/obj/rel
VERSION = 1

SOURCES = \
	$(wildcard src/modules/*.c) \
	$(wildcard src/modules/zen_core/*.c) \
	$(wildcard src/modules/zen_math/*.c) \
	$(wildcard src/modules/zen_wm/*.c) \
	$(wildcard src/modules/image/*.c) \
	$(wildcard src/modules/zen_media_player/*.c) \
	$(wildcard src/modules/zen_media_transcoder/*.c) \
	$(wildcard src/modules/zen_ui/*.c) \
	$(wildcard src/modules/zen_ui/gl/*.c) \
	$(wildcard src/modules/zen_ui/view/*.c) \
	$(wildcard src/modules/zen_ui/text/*.c) \
	$(wildcard src/modules/zen_ui/html/*.c) \
	$(wildcard src/zenmusic/*.c) \
	$(wildcard src/zenmusic/ui/*.c)

CFLAGS = \
	-I/usr/include \
	-I/usr/include/GL \
	-I/usr/include/SDL2 \
	-Isrc/modules \
	-Isrc/modules/zen_core \
	-Isrc/modules/zen_math \
	-Isrc/modules/zen_wm \
	-Isrc/modules/image \
	-Isrc/modules/zen_media_player \
	-Isrc/modules/zen_media_transcoder \
	-Isrc/modules/zen_ui \
	-Isrc/modules/zen_ui/gl \
	-Isrc/modules/zen_ui/view \
	-Isrc/modules/zen_ui/text \
	-Isrc/modules/zen_ui/html \
	-Isrc/zenmusic \
	-Isrc/zenmusic/ui

LDFLAGS = \
	-L/usr/local/lib \
	-lm \
	-lGL \
	-lGLEW \
	-lSDL2 \
	-lavutil \
	-lavcodec \
	-lavdevice \
	-lavformat \
	-lavfilter \
	-lswresample \
	-lswscale \
	-lpthread

OBJECTSREL := $(addprefix $(OBJDIRREL)/,$(SOURCES:.c=.o))

build: $(OBJECTSREL)
	$(CC) $^ -o bin/zenmusic $(LDFLAGS)

$(OBJECTSREL): $(OBJDIRREL)/%.o: %.c
	mkdir -p $(@D)
	$(CC) -c $< -o $@ $(CFLAGS) -O3 -DVERSION=$(VERSION) -DBUILD=$(shell cat version.num)

clean:
	rm -f $(OBJECTSREL) zenmusic

install: build
	/usr/bin/install -c -s -m 755 bin/zenmusic /usr/bin
	/usr/bin/install -d -m 755 /usr/share/zenmusic
	cp res/* /usr/share/zenmusic/

remove:
	rm /usr/bin/zenmusic
	rm -r /usr/share/zenmusic
